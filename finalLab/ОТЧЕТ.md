# ОТЧЕТ ПО ИНДИВИДУАЛЬНОМУ ПРОЕКТУ

## ТИТУЛЬНЫЙ ЛИСТ

**МИНИСТЕРСТВО НАУКИ И ВЫСШЕГО ОБРАЗОВАНИЯ РОССИЙСКОЙ ФЕДЕРАЦИИ**

**УЧЕБНОЕ ЗАВЕДЕНИЕ**

**Кафедра информационных технологий**

---

### ИНДИВИДУАЛЬНЫЙ ПРОЕКТ

**Тема:** Система управления книжным магазином

**По дисциплине:** Учебная практика

**Выполнил:** Студент группы П50-2-21

**Проверил:** Преподаватель

---

**Год:** 2024

---

## СОДЕРЖАНИЕ

1. [Тема индивидуального проекта](#1-тема-индивидуального-проекта)
2. [Описание предметной области](#2-описание-предметной-области)
3. [Диаграмма базы данных](#3-диаграмма-базы-данных)
   - 3.1. Логическая (инфологическая) модель
   - 3.2. Физическая (даталогическая) модель
4. [Реализация программы](#4-реализация-программы)
   - 4.1. Архитектура приложения
   - 4.2. Основные компоненты
   - 4.3. REST API
   - 4.4. Система авторизации
   - 4.5. Валидация данных
5. [Демонстрация работы программы](#5-демонстрация-работы-программы)
6. [Заключение](#6-заключение)

---

## 1. ТЕМА ИНДИВИДУАЛЬНОГО ПРОЕКТА

**Система управления книжным магазином**

Разработка веб-приложения для управления книжным магазином с использованием Spring Boot, REST API, Spring Security и PostgreSQL. Система должна обеспечивать полный цикл управления: от каталога книг до обработки заказов, с разделением прав доступа для различных ролей пользователей.

---

## 2. ОПИСАНИЕ ПРЕДМЕТНОЙ ОБЛАСТИ

### 2.1. Предметная область

Книжный магазин - это система, которая позволяет управлять:
- **Каталогом книг**: информация о книгах, авторах, издательствах, жанрах
- **Складом**: отслеживание остатков книг на складе
- **Заказами**: создание и обработка заказов клиентов
- **Пользователями**: регистрация, авторизация, управление профилями
- **Отзывами**: возможность оставлять отзывы на книги

### 2.2. Основные сущности

1. **Пользователь (User)** - клиент или сотрудник магазина
   - Имя пользователя, email, пароль
   - Полное имя, телефон, адрес
   - Связь с ролями (многие ко многим)

2. **Роль (Role)** - определяет права доступа
   - ADMIN - администратор системы
   - MANAGER - менеджер магазина
   - USER - обычный пользователь

3. **Книга (Book)** - основной товар магазина
   - Название, ISBN, цена, количество страниц
   - Год издания, описание
   - Связь с авторами (многие ко многим)
   - Связь с жанрами (многие ко многим)
   - Связь с издательством (многие к одному)

4. **Автор (Author)** - автор книги
   - Имя, фамилия, биография
   - Связь с книгами (многие ко многим)

5. **Издательство (Publisher)** - издатель книг
   - Название, адрес, телефон, email
   - Связь с книгами (один ко многим)

6. **Жанр (Genre)** - жанр книги
   - Название, описание
   - Связь с книгами (многие ко многим)

7. **Заказ (Order)** - заказ клиента
   - Пользователь, дата заказа, статус
   - Общая сумма, адрес доставки, примечания
   - Связь с позициями заказа (один ко многим)

8. **Позиция заказа (OrderItem)** - товар в заказе
   - Книга, количество, цена
   - Связь с заказом (многие к одному)

9. **Отзыв (Review)** - отзыв на книгу
   - Пользователь, книга, рейтинг (1-5)
   - Комментарий, дата отзыва

10. **Склад (Warehouse)** - остатки на складе
    - Книга, количество, минимальный порог
    - Связь с книгой (один к одному)

### 2.3. Бизнес-процессы

1. **Регистрация и авторизация**
   - Пользователь регистрируется в системе
   - При регистрации автоматически присваивается роль USER
   - Администратор может изменять роли пользователей

2. **Управление каталогом**
   - Администратор добавляет книги, авторов, издательства, жанры
   - Все данные проходят валидацию

3. **Оформление заказа**
   - Пользователь выбирает книги
   - Система проверяет наличие на складе
   - При создании заказа уменьшается количество на складе

4. **Обработка заказов**
   - Менеджер обрабатывает заказы
   - Изменяет статус заказа (PENDING → PROCESSING → SHIPPED → DELIVERED)

5. **Управление складом**
   - Менеджер отслеживает остатки
   - Система предупреждает о низких остатках

---

## 3. ДИАГРАММА БАЗЫ ДАННЫХ

### 3.1. Логическая (инфологическая) модель

```
┌─────────────┐         ┌──────────────┐         ┌─────────────┐
│    User     │◄───────►│  User_Roles  │◄───────►│    Role     │
│             │         │              │         │             │
│ - id        │         │ - user_id    │         │ - id        │
│ - username  │         │ - role_id    │         │ - name      │
│ - email     │         └──────────────┘         └─────────────┘
│ - password  │
│ - full_name │         ┌─────────────┐
│ - phone     │         │    Order    │
│ - address   │         │             │
└──────┬──────┘         │ - id        │
       │                │ - user_id   │
       │                │ - order_date│
       │                │ - status    │
       │                │ - total     │
       │                └──────┬──────┘
       │                       │
       │                ┌──────▼──────┐
       │                │  OrderItem   │
       │                │              │
       │                │ - id        │
       │                │ - order_id  │
       │                │ - book_id   │
       │                │ - quantity  │
       │                │ - price     │
       │                └──────┬──────┘
       │                       │
       │                ┌──────▼──────┐
       │                │    Book     │
       │                │             │
       │                │ - id        │
       │                │ - title     │
       │                │ - isbn      │
       │                │ - price     │
       │                │ - pages     │
       │                │ - year      │
       │                │ - publisher │
       │                └──────┬──────┘
       │                       │
       │                ┌──────▼──────┐         ┌─────────────┐
       │                │ Book_Authors│◄───────►│   Author    │
       │                │             │         │             │
       │                │ - book_id   │         │ - id        │
       │                │ - author_id │         │ - first_name│
       │                └─────────────┘         │ - last_name │
       │                                       │ - biography │
       │                ┌─────────────┐         └─────────────┘
       │                │ Book_Genres │
       │                │             │         ┌─────────────┐
       │                │ - book_id   │         │  Publisher  │
       │                │ - genre_id  │         │             │
       │                └──────┬──────┘         │ - id        │
       │                       │                │ - name      │
       │                ┌──────▼──────┐         │ - address   │
       │                │    Genre    │         │ - phone     │
       │                │             │         │ - email     │
       │                │ - id        │         └─────────────┘
       │                │ - name      │
       │                │ - desc      │
       │                └─────────────┘
       │
       │                ┌─────────────┐
       │                │   Review     │
       │                │              │
       │                │ - id         │
       │                │ - user_id    │
       │                │ - book_id    │
       │                │ - rating     │
       │                │ - comment     │
       │                │ - review_date │
       │                └──────────────┘
       │
       │                ┌─────────────┐
       │                │  Warehouse   │
       │                │              │
       │                │ - id         │
       │                │ - book_id     │
       │                │ - quantity   │
       │                │ - min_thresh │
       │                └──────────────┘
```

### 3.2. Физическая (даталогическая) модель

#### Таблицы и связи:

1. **users** (id, username, email, password, full_name, phone, address)
2. **roles** (id, name)
3. **user_roles** (user_id, role_id) - связующая таблица
4. **authors** (id, first_name, last_name, biography)
5. **publishers** (id, name, address, phone, email)
6. **genres** (id, name, description)
7. **books** (id, title, isbn, price, pages, publication_year, description, publisher_id)
8. **book_authors** (book_id, author_id) - связующая таблица
9. **book_genres** (book_id, genre_id) - связующая таблица
10. **orders** (id, user_id, order_date, status, total_amount, shipping_address, notes)
11. **order_items** (id, order_id, book_id, quantity, price)
12. **reviews** (id, user_id, book_id, rating, comment, review_date)
13. **warehouse** (id, book_id, quantity, min_threshold)

#### Типы связей:

- **User ↔ Role**: Многие ко многим (через user_roles)
- **User → Order**: Один ко многим
- **User → Review**: Один ко многим
- **Book ↔ Author**: Многие ко многим (через book_authors)
- **Book ↔ Genre**: Многие ко многим (через book_genres)
- **Book → Publisher**: Многие к одному
- **Book → Warehouse**: Один к одному
- **Order → OrderItem**: Один ко многим
- **OrderItem → Book**: Многие к одному
- **Review → Book**: Многие к одному
- **Review → User**: Многие к одному

---

## 4. РЕАЛИЗАЦИЯ ПРОГРАММЫ

### 4.1. Архитектура приложения

Приложение построено по многослойной архитектуре:

```
┌─────────────────────────────────────┐
│         Presentation Layer          │
│  (Thymeleaf Templates + REST API)  │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│         Controller Layer             │
│  (Web Controllers + REST Controllers)│
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│          Service Layer              │
│      (Business Logic)                │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│        Repository Layer              │
│      (Data Access - JPA)              │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│         Database Layer               │
│         (PostgreSQL)                 │
└─────────────────────────────────────┘
```

### 4.2. Основные компоненты

#### 4.2.1. Модели (Entity)

Все модели используют аннотации JPA для маппинга на таблицы БД:

```java
@Entity
@Table(name = "books")
public class Book {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank(message = "Название книги обязательно")
    @Size(max = 500)
    private String title;
    
    // ... другие поля с валидацией
}
```

#### 4.2.2. Репозитории

Используется Spring Data JPA для упрощения работы с БД:

```java
@Repository
public interface BookRepository extends JpaRepository<Book, Long> {
    List<Book> findByTitleContainingIgnoreCase(String title);
    Optional<Book> findByIsbn(String isbn);
}
```

#### 4.2.3. Сервисы

Бизнес-логика вынесена в сервисный слой:

```java
@Service
@Transactional
public class BookService {
    public Book createBook(Book book) {
        // Валидация и создание книги
    }
    
    public Book updateBook(Long id, Book bookDetails) {
        // Обновление книги
    }
}
```

### 4.3. REST API

Все операции с данными выполняются через REST API:

#### Примеры эндпоинтов:

**Книги:**
- `GET /api/books` - получить все книги
- `GET /api/books/{id}` - получить книгу по ID
- `POST /api/books` - создать книгу
- `PUT /api/books/{id}` - обновить книгу
- `DELETE /api/books/{id}` - удалить книгу

**Заказы:**
- `GET /api/orders` - получить все заказы
- `POST /api/orders` - создать заказ
- `PUT /api/orders/{id}/status` - обновить статус заказа

Все контроллеры используют аннотации Swagger для автоматической генерации документации.

### 4.4. Система авторизации

#### 4.4.1. Spring Security Configuration

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/admin/**").hasAuthority("ROLE_ADMIN")
                .requestMatchers("/manager/**").hasAnyAuthority("ROLE_ADMIN", "ROLE_MANAGER")
                .requestMatchers("/user/**").hasAnyAuthority("ROLE_ADMIN", "ROLE_MANAGER", "ROLE_USER")
                .anyRequest().authenticated()
            )
            .formLogin(...)
            .logout(...);
    }
}
```

#### 4.4.2. Шифрование паролей

Используется BCrypt для безопасного хранения паролей:

```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```

### 4.5. Валидация данных

#### 4.5.1. Валидация на уровне модели

```java
public class Book {
    @NotBlank(message = "Название книги обязательно")
    @Size(max = 500)
    private String title;
    
    @NotNull(message = "Цена обязательна")
    @DecimalMin(value = "0.0", inclusive = false)
    private BigDecimal price;
}
```

#### 4.5.2. Валидация на уровне контроллера

```java
@PostMapping
public ResponseEntity<Book> createBook(@Valid @RequestBody Book book) {
    // Валидация выполняется автоматически
}
```

#### 4.5.3. Глобальная обработка ошибок

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<Map<String, Object>> handleValidationException(...) {
        // Обработка ошибок валидации
    }
}
```

---

## 5. ДЕМОНСТРАЦИЯ РАБОТЫ ПРОГРАММЫ

### 5.1. Регистрация пользователя

1. Переход на страницу регистрации: `/register`
2. Заполнение формы с валидацией:
   - Имя пользователя (минимум 3 символа)
   - Email (корректный формат)
   - Пароль (минимум 8 символов, заглавная буква, цифра, спецсимвол)
   - Полное имя
3. После успешной регистрации - автоматический переход на страницу входа

### 5.2. Авторизация

1. Вход в систему с учетными данными
2. Автоматическое перенаправление на главную страницу
3. Отображение пунктов меню в зависимости от роли

### 5.3. Работа с книгами через REST API

**Создание книги:**
```bash
curl -X POST http://localhost:8083/api/books \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic ..." \
  -d '{
    "title": "Новая книга",
    "isbn": "978-5-17-123459-8",
    "price": 599.00,
    "pages": 400,
    "publicationYear": 2024
  }'
```

**Получение всех книг:**
```bash
curl http://localhost:8083/api/books
```

### 5.4. Разделение прав доступа

#### Роль ADMIN:
- Видит пункты меню: "Панель администратора", "Управление книгами", "Все заказы"
- Имеет доступ ко всем функциям системы

#### Роль MANAGER:
- Видит пункты меню: "Панель менеджера", "Склад", "Заказы"
- Может управлять заказами и складом

#### Роль USER:
- Видит пункты меню: "Мой профиль", "Каталог книг"
- Может просматривать каталог и создавать заказы

### 5.5. Swagger UI

Документация API доступна по адресу: `http://localhost:8083/swagger-ui.html`

Позволяет:
- Просматривать все доступные эндпоинты
- Тестировать API прямо в браузере
- Видеть схемы данных и примеры запросов

### 5.6. Обработка ошибок

При возникновении ошибок система возвращает структурированный ответ:

```json
{
  "timestamp": "2024-12-17T15:30:00",
  "status": 404,
  "error": "Not Found",
  "message": "Книга с ID 999 не найдена",
  "path": "/api/books/999"
}
```

---

## 6. ЗАКЛЮЧЕНИЕ

В ходе выполнения индивидуального проекта была разработана полнофункциональная система управления книжным магазином, которая включает:

✅ **CRUD операции** для всех сущностей через REST API
✅ **Систему авторизации и регистрации** с разделением прав доступа
✅ **3 роли пользователей** с разным функционалом
✅ **Валидацию данных** на всех уровнях
✅ **Глобальную обработку ошибок**
✅ **Swagger документацию** для API
✅ **Современный UI** с Bootstrap

Проект демонстрирует применение всех изученных технологий:
- Spring Boot для создания веб-приложения
- Spring Security для безопасности
- Spring Data JPA для работы с БД
- REST API для взаимодействия с данными
- Thymeleaf для создания UI
- PostgreSQL как СУБД

Система готова к использованию и может быть расширена дополнительным функционалом.

---

**Дата:** Декабрь 2024


